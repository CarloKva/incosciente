<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Inconsciente">
  <title>Inconsciente — Maca Cerquera</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Marcellus&display=swap" rel="stylesheet">
  <style>
    :root {
      --postit-size: 88px;
      --postit-font: 12px;
      --postit-tape-w: 32px;
      --postit-tape-h: 11px;
    }
    @media (min-width: 600px) {
      :root { --postit-size: 100px; --postit-font: 13px; --postit-tape-w: 36px; --postit-tape-h: 12px; }
    }
    @media (min-width: 900px) {
      :root { --postit-size: 110px; --postit-font: 14px; --postit-tape-w: 40px; --postit-tape-h: 14px; }
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%; overflow: hidden;
      font-family: 'Marcellus', serif;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
      user-select: none; -webkit-user-select: none;
    }

    /* --- LOADING --- */
    #loading-screen {
      position: fixed; inset: 0; z-index: 100; background: #fff;
      display: flex; align-items: center; justify-content: center;
      transition: opacity 0.5s ease;
    }
    #loading-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    #loading-screen span { font-family: 'Marcellus', serif; font-size: clamp(20px,5vw,28px); color: #2a2a2a; }

    /* --- CODE SCREEN --- */
    #code-screen {
      z-index: 50; background: #fff;
    }
    #code-screen .wall-title { margin-bottom: clamp(6px,1vh,10px); }
    .wall-subtitle {
      font-family: 'Marcellus', serif; font-size: clamp(16px,3.5vw,20px);
      color: #888; margin-bottom: clamp(12px,2vh,18px);
      letter-spacing: 1px;
    }
    .install-desc {
      font-family: 'Marcellus', serif; font-size: clamp(11px,2.2vw,14px);
      color: #999; text-align: center; line-height: 1.6;
      max-width: min(440px, 85vw); margin-bottom: clamp(20px,4vh,36px);
      padding: 0 10px;
    }
    .install-desc em { font-style: italic; color: #aaa; }
    #code-screen .wall-input-row { justify-content: center; }
    #code-input {
      flex: 1; min-width: 0; max-width: 220px;
      font-family: 'Marcellus', serif; font-size: clamp(18px,4vw,22px);
      color: #2a2a2a; background: transparent;
      border: none; border-bottom: 1.5px solid #2a2a2a; outline: none;
      padding: 6px 2px; text-align: center; text-transform: uppercase;
      letter-spacing: 2px;
      user-select: text; -webkit-user-select: text;
      touch-action: manipulation;
    }
    #code-input::placeholder { color: #bbb; text-transform: none; letter-spacing: 0.5px; }
    .code-error {
      font-size: clamp(13px,2.5vw,15px); color: #e74c3c;
      margin-top: 10px; min-height: 1.5em; text-align: center;
    }

    /* --- WALL --- */
    #wall { position: fixed; inset: 0; z-index: 1; background: #fff; overflow: hidden; }

    /* --- LANG PICKER --- */
    #lang-picker {
      position: fixed; z-index: 6;
      top: clamp(12px,2vh,20px); right: clamp(12px,3vw,20px);
      display: flex; gap: 6px;
    }
    .lang-btn {
      font-family: 'Marcellus', serif; font-size: clamp(11px,2.2vw,13px);
      color: #bbb; background: none; border: none;
      cursor: pointer; padding: 4px 6px;
      touch-action: manipulation; -webkit-tap-highlight-color: transparent;
      letter-spacing: 0.5px; transition: color 0.2s;
    }
    .lang-btn.active { color: #2a2a2a; text-decoration: underline; text-underline-offset: 3px; }

    /* --- WALL UI (title + input inline) --- */
    #wall-ui {
      position: fixed; z-index: 5; inset: 0;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center;
      padding: 0 20px;
      pointer-events: none; transition: opacity 0.35s ease;
    }
    #wall-ui.hidden { opacity: 0; pointer-events: none; }
    .wall-title {
      font-size: clamp(28px,7vw,42px); color: #2a2a2a;
      margin-bottom: clamp(12px,2vh,20px);
      text-shadow: 0 1px 8px rgba(255,255,255,0.8);
    }

    /* Input row */
    .wall-input-row {
      display: flex; align-items: center; gap: 10px;
      width: 100%; max-width: 420px;
      margin-bottom: clamp(8px,1.5vh,14px);
      pointer-events: auto;
    }
    #question-input {
      flex: 1; min-width: 0;
      font-family: 'Marcellus', serif; font-size: clamp(16px,3.5vw,20px);
      color: #2a2a2a; background: transparent;
      border: none; border-bottom: 1.5px solid #2a2a2a; outline: none;
      padding: 6px 2px;
      user-select: text; -webkit-user-select: text;
      touch-action: manipulation;
    }
    #question-input::placeholder { color: #bbb; }
    #submit-btn, #code-submit-btn {
      font-family: 'Marcellus', serif; font-size: clamp(18px,4vw,22px);
      color: #2a2a2a; background: none; border: 2px solid #2a2a2a;
      border-radius: 50%; width: clamp(40px,8vw,48px); height: clamp(40px,8vw,48px);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      flex-shrink: 0; line-height: 1;
    }
    #submit-btn:active, #code-submit-btn:active { transform: scale(0.92); }

    .wall-counter {
      font-size: clamp(12px,2.5vw,15px); color: #bbb;
      pointer-events: none;
    }

    /* --- WALL POST-IT --- */
    .postit {
      position: absolute;
      width: var(--postit-size); height: var(--postit-size);
      padding: 18px 6px 6px 6px;
      font-family: 'Caveat', cursive; font-size: var(--postit-font);
      line-height: 1.2; color: #2a2a2a;
      overflow: hidden; word-wrap: break-word;
      box-shadow: 1px 2px 6px rgba(0,0,0,0.18);
      contain: layout style;
    }
    .postit-original {
      display: block;
    }
    .postit-italian {
      display: block;
      font-size: 0.82em;
      opacity: 0.72;
      font-style: italic;
      margin-top: 3px;
    }
    .postit::before {
      content: ''; position: absolute; top: -2px; left: 50%;
      transform: translateX(-50%);
      width: var(--postit-tape-w); height: var(--postit-tape-h);
      background: rgba(255,255,255,0.5); border-radius: 1px;
    }
    .postit::after {
      content: ''; position: absolute; bottom: 0; right: 0;
      width: 16px; height: 16px;
      background: linear-gradient(225deg, rgba(0,0,0,0.06) 0%, rgba(0,0,0,0.02) 40%, transparent 60%);
    }
    .postit.fly-in { animation: flyIn 0.65s ease-out forwards; }
    .postit.dragging {
      z-index: 50; box-shadow: 3px 6px 20px rgba(0,0,0,0.3);
      transform: scale(1.08) rotate(0deg) !important;
      transition: box-shadow 0.2s ease;
    }

    #placement-hint {
      position: fixed; z-index: 55;
      top: clamp(20px,4vh,40px); left: 0; right: 0;
      text-align: center; font-size: clamp(16px,3.5vw,20px);
      color: #555; pointer-events: none;
      transition: opacity 0.35s ease;
      text-shadow: 0 1px 8px rgba(255,255,255,0.9);
    }
    #placement-hint.hidden { opacity: 0; }

    /* --- REVEAL SCREEN --- */
    .screen {
      position: fixed; inset: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.35s ease, visibility 0.35s ease;
    }
    .screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

    #reveal-screen { z-index: 30; background: rgba(0,0,0,0.72); padding: 20px; }
    .reveal-wrapper {
      display: flex; flex-direction: column; align-items: center;
      gap: clamp(16px,3vh,24px); max-width: 100%;
    }
    .reveal-question {
      font-size: clamp(15px,3.5vw,18px);
      color: rgba(255,255,255,0.75); font-style: italic;
      max-width: min(340px,80vw); text-align: center;
    }
    .reveal-postit {
      width: min(260px,65vw); height: min(260px,65vw);
      padding: clamp(20px,5vw,32px) clamp(12px,3vw,18px) clamp(12px,3vw,18px) clamp(12px,3vw,18px);
      font-family: 'Caveat', cursive; font-size: clamp(17px,4vw,22px);
      line-height: 1.3; color: #2a2a2a;
      display: flex; align-items: center; justify-content: center;
      text-align: center; word-wrap: break-word;
      box-shadow: 2px 4px 16px rgba(0,0,0,0.3); position: relative;
    }
    .reveal-postit::before {
      content: ''; position: absolute; top: -3px; left: 50%;
      transform: translateX(-50%);
      width: clamp(40px,10vw,56px); height: clamp(14px,3vw,18px);
      background: rgba(255,255,255,0.45); border-radius: 1px;
    }
    .reveal-postit::after {
      content: ''; position: absolute; bottom: 0; right: 0;
      width: 24px; height: 24px;
      background: linear-gradient(225deg, rgba(0,0,0,0.06) 0%, rgba(0,0,0,0.02) 40%, transparent 60%);
    }
    .reveal-postit.pop { animation: revealPop 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards; }
    .btn {
      font-family: 'Marcellus', serif; font-size: clamp(18px,4vw,22px);
      color: #fff; background: transparent;
      border: 2px solid rgba(255,255,255,0.6); border-radius: 12px;
      padding: clamp(10px,2vw,12px) clamp(24px,6vw,36px);
      cursor: pointer; touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active { transform: scale(0.96); }

    /* --- READ-ONLY BANNER --- */
    .readonly-banner {
      position: fixed; top: 0; left: 0; right: 0; z-index: 10;
      text-align: center; padding: 10px 20px;
      font-family: 'Marcellus', serif; font-size: clamp(14px,3vw,18px);
      color: #fff; background: rgba(0,0,0,0.7);
      pointer-events: none;
    }
    .readonly-banner.hidden { display: none; }

    /* --- ADMIN BUTTON --- */
    .admin-btn {
      position: fixed; bottom: 20px; right: 20px; z-index: 10;
      font-family: 'Marcellus', serif; font-size: 12px;
      color: #999; background: rgba(255,255,255,0.85);
      border: 1px solid #ccc; border-radius: 6px;
      padding: 6px 14px; cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .admin-btn:active { transform: scale(0.95); }
    .admin-btn.hidden { display: none; }

    /* --- ANIMATIONS --- */
    @keyframes flyIn {
      0%   { transform: translateY(-110vh) rotate(0deg); opacity: 0; }
      10%  { opacity: 1; }
      55%  { transform: translateY(12px) rotate(var(--rot,0deg)); }
      100% { transform: translateY(0) rotate(var(--rot,0deg)); }
    }
    @keyframes revealPop {
      0%   { transform: scale(0.15) rotate(-12deg); opacity: 0; }
      50%  { transform: scale(1.08) rotate(1deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
  </style>
</head>
<body>

  <div id="code-screen" class="screen hidden">
    <div class="wall-title">Inconsciente</div>
    <div class="wall-subtitle">Maca Cerquera</div>
    <div class="install-desc">
      Intervention con escritura en post-its · Medidas variables · Work in progress since 2012<br>
      <em>This project is based on thoughts and desires that I express from within.
      Playing with the emotions and desires that sometimes no one dares to say.
      I like to imagine the journey that these phrases make in others, generating an inevitable complicity.</em>
    </div>
    <div class="wall-input-row">
      <input type="text" id="code-input" autocomplete="off" autocorrect="off" autocapitalize="characters" spellcheck="false">
      <button id="code-submit-btn">&rarr;</button>
    </div>
    <div class="code-error" id="code-error"></div>
  </div>

  <div id="wall"></div>

  <div id="lang-picker">
    <button class="lang-btn active" data-lang="it">IT</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="es">ES</button>
  </div>

  <div id="wall-ui" class="hidden">
    <div class="wall-title">Inconsciente</div>
    <div class="wall-input-row">
      <input type="text" id="question-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      <button id="submit-btn">&rarr;</button>
    </div>
    <div class="wall-counter" id="counter"></div>
  </div>

  <div id="placement-hint" class="hidden"></div>

  <div id="reveal-screen" class="screen hidden">
    <div class="reveal-wrapper" id="reveal-wrapper">
      <div class="reveal-question" id="reveal-question"></div>
      <div class="reveal-postit" id="reveal-postit"></div>
      <button class="btn" id="paste-btn"></button>
    </div>
  </div>

  <div id="readonly-banner" class="readonly-banner hidden"></div>
  <button id="admin-close-btn" class="admin-btn hidden"></button>

  <div id="loading-screen">
    <span id="t-loading"></span>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
(function () {
  'use strict';

  // =============================================
  // SUPABASE CONFIG — replace with your project values
  // =============================================
  var SUPABASE_URL = 'https://audcqtzdrxlkawujvanl.supabase.co';
  var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF1ZGNxdHpkcnhsa2F3dWp2YW5sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMTQ1NTMsImV4cCI6MjA4Njg5MDU1M30.NSrcBkohczfaX3xlYlLXXxI6K7tkPLpW87B1ne3xH-w';
  var sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // --- i18n ---
  var I18N = {
    it: {
      placeholder: 'parlami...',
      counter: '{n} post-it sul muro',
      hint: 'Trascina il post-it dove vuoi',
      pasteBtn: 'incolla sul muro \u2192',
      loading: 'Inconsciente...',
      codePlaceholder: 'codice di accesso',
      codeError: 'Codice non valido',
      wallClosed: 'Questo muro \u00e8 stato chiuso',
      closeWall: 'Chiudi Muro',
      closeConfirm: 'Sei sicuro di voler chiudere il muro? Verr\u00e0 scaricato uno screenshot.'
    },
    en: {
      placeholder: 'tell me...',
      counter: '{n} post-its on the wall',
      hint: 'Drag the post-it where you want',
      pasteBtn: 'stick to the wall \u2192',
      loading: 'Inconsciente...',
      codePlaceholder: 'access code',
      codeError: 'Invalid code',
      wallClosed: 'This wall has been closed',
      closeWall: 'Close Wall',
      closeConfirm: 'Are you sure you want to close the wall? A screenshot will be downloaded.'
    },
    es: {
      placeholder: 'h\u00e1blame...',
      counter: '{n} post-it en el muro',
      hint: 'Arrastra el post-it donde quieras',
      pasteBtn: 'pega en el muro \u2192',
      loading: 'Inconsciente...',
      codePlaceholder: 'c\u00f3digo de acceso',
      codeError: 'C\u00f3digo no v\u00e1lido',
      wallClosed: 'Este muro ha sido cerrado',
      closeWall: 'Cerrar Muro',
      closeConfirm: '\u00bfEst\u00e1s seguro de que quieres cerrar el muro? Se descargar\u00e1 una captura.'
    }
  };

  var currentLang = 'it';
  function t(key) { return I18N[currentLang][key] || I18N.it[key] || key; }

  function applyLang() {
    document.getElementById('question-input').placeholder = t('placeholder');
    document.getElementById('code-input').placeholder = t('codePlaceholder');
    document.getElementById('placement-hint').textContent = t('hint');
    document.getElementById('paste-btn').textContent = t('pasteBtn');
    document.getElementById('t-loading').textContent = t('loading');
    document.getElementById('admin-close-btn').textContent = t('closeWall');
    updateCounter();
    var btns = document.querySelectorAll('.lang-btn');
    for (var i = 0; i < btns.length; i++) {
      btns[i].classList.toggle('active', btns[i].dataset.lang === currentLang);
    }
    document.documentElement.lang = currentLang;
  }

  function setLang(lang) {
    if (!I18N[lang]) return;
    currentLang = lang;
    try { localStorage.setItem('oracolo_lang', lang); } catch(e) {}
    applyLang();
  }

  // --- PHRASES ---
  var FRASI = [
    { original: 'A dick has no brain', italian: 'Un coglione non ha cervello' },
    { original: 'Kiss me', italian: 'Baciami' },
    { original: 'Eternity is now', italian: 'L\'eternità è adesso' },
    { original: 'Everything es una ilusión', italian: 'Tutto è un\'illusione' },
    { original: 'I cry', italian: 'Piango' },
    { original: 'Love and mortality', italian: 'Amore e mortalità' },
    { original: 'Una lágrima puede todo', italian: 'Una lacrima può tutto' },
    { original: 'Te regalo todas mis lágrimas', italian: 'Ti regalo tutte le mie lacrime' },
    { original: 'Soy una víctima del amor', italian: 'Sono una vittima dell\'amore' },
    { original: 'Vos siempre en vos', italian: 'Tu sempre in te' },
    { original: 'Tears of love', italian: 'Lacrime d\'amore' },
    { original: 'I love this song', italian: 'Amo questa canzone' },
    { original: 'I\'ll give you all my dreams', italian: 'Ti darò tutti i miei sogni' },
    { original: 'I miss crying', italian: 'Mi manca piangere' },
    { original: 'I wanna fly with you', italian: 'Voglio volare con te' },
    { original: 'My heart is in pain', italian: 'Il mio cuore soffre' },
    { original: 'I wanna cry forever', italian: 'Voglio piangere per sempre' },
    { original: 'Bebita salvaje', italian: 'Bambina selvaggia' },
    { original: 'Find me here', italian: 'Trovami qui' },
    { original: 'Are you cumin?', italian: 'Sei cumino?' },
    { original: 'Why are you crying?', italian: 'Perché stai piangendo?' },
    { original: 'Soy tu reina', italian: 'Sono la tua regina' },
    { original: 'This is the end', italian: 'Questa è la fine' },
    { original: 'A veces te sueño', italian: 'A volte ti sogno' },
    { original: 'I miss your smell', italian: 'Mi manca il tuo odore' },
    { original: 'Love like a popper dance and cry', italian: 'Ama come un popper balla e piangi' },
    { original: 'Seamos infinitos otra vez', italian: 'Siamo infiniti un\'altra volta' },
    { original: 'Te vi mirarme', italian: 'Ti ho visto guardarmi' },
    { original: 'Nunca dejes de buscarme', italian: 'Non smettere mai di cercarmi' },
    { original: 'Contémonos la vida', italian: 'Raccontiamoci la vita' },
    { original: 'Amor somos nosotros', italian: 'L\'amore siamo noi' },
    { original: 'A veces no quiero ser feliz', italian: 'A volte non voglio essere felice' },
    { original: 'Tú en mis desayunos', italian: 'Tu nelle mie colazioni' },
    { original: 'I like sleeping with you', italian: 'Mi piace dormire con te' },
    { original: 'You\'re not my world', italian: 'Non sei il mio mondo' },
    { original: 'Quiero todo contigo', italian: 'Voglio tutto con te' },
    { original: 'Intentar olvidar', italian: 'Cercare di dimenticare' },
    { original: 'Nuestras noches infinitas', italian: 'Le nostre notti infinite' },
    { original: 'Sos todas las montañas desde mi balcón', italian: 'Sei tutte le montagne dal mio balcone' },
    { original: 'I want you to show me your dream', italian: 'Voglio che tu mi mostri il tuo sogno' },
    { original: 'Olvidarnos para nunca despedirnos', italian: 'Dimenticarci per non dirci mai addio' },
    { original: 'Tenemos un cielo en los pies', italian: 'Abbiamo un cielo ai piedi' },
    { original: 'You found me', italian: 'Mi hai trovato' },
    { original: 'I like waiting for you', italian: 'Mi piace aspettarti' },
    { original: 'I love what we do', italian: 'Amo quello che facciamo' },
    { original: 'Forget me please', italian: 'Dimenticami per favore' },
    { original: 'Quiero ir a la Antártida with you', italian: 'Voglio andare in Antartide con te' },
    { original: 'Me duele la noche sin ta novie', italian: 'Mi fa male la notte senza il tuo amore' },
    { original: 'Let\'s hate the world juntitos', italian: 'Odiamo il mondo insieme' },
    { original: 'Moriría contigo', italian: 'Morirei con te' },
    { original: 'Paz amor y euros', italian: 'Pace amore ed euro' },
    { original: 'Que vuelvan nuestros sábados', italian: 'Che tornino i nostri sabati' },
    { original: 'Abrazos infinitos me das tu', italian: 'Mi dai abbracci infiniti' },
    { original: 'No quiero verte conmigo', italian: 'Non voglio vederti con me' },
    { original: 'El olor de tu ausencia', italian: 'Il profumo della tua assenza' },
    { original: 'Nos creía invencibles', italian: 'Ci credevo invincibili' },
    { original: 'Somos la nada y el vacío', italian: 'Siamo il nulla e il vuoto' },
    { original: 'Siempre pienso en ti', italian: 'Penso sempre a te' },
    { original: 'No puedo soñarte', italian: 'Non riesco a sognarti' },
    { original: 'You could be my favorite new year', italian: 'Potresti essere il mio capodanno preferito' },
    { original: 'Me gusta ser feliz sin ti', italian: 'Mi piace essere felice senza di te' },
    { original: 'Spring is here', italian: 'La primavera è arrivata' },
    { original: 'Me gusta esta vida', italian: 'Mi piace questa vita' },
    { original: 'Me suenas en tu cama', italian: 'Mi risuoni nel tuo letto' },
    { original: 'Llévame a tu nube', italian: 'Portami sulla tua nuvola' },
    { original: 'Extraño tu desorden en mi', italian: 'Mi manca il tuo disordine in me' },
    { original: 'Sos mi feriado favorito', italian: 'Sei la mia festa preferita' },
    { original: 'Dónde estás?', italian: 'Dove sei?' },
    { original: 'Quiero mañanas eternas', italian: 'Voglio mattine eterne' },
    { original: 'Hacer nada juntos', italian: 'Non fare niente insieme' },
    { original: 'Hablar en silencio', italian: 'Parlare in silenzio' },
    { original: 'Te olvidaré', italian: 'Ti dimenticherò' },
    { original: 'Olvidé todo mi amor', italian: 'Ho dimenticato tutto il mio amore' },
    { original: 'Hicimos todo', italian: 'Abbiamo fatto tutto' },
    { original: 'Volver a nacer', italian: 'Rinascere' },
    { original: 'Elijo lo que quiero ser', italian: 'Scelgo quello che voglio essere' },
    { original: 'Me gusta estar sola', italian: 'Mi piace stare sola' },
    { original: 'Quedándote o yéndote', italian: 'Restando o andando' },
    { original: 'Mis domingos te extrañan', italian: 'Le mie domeniche ti mancano' },
    { original: '...y si te espero en Roma?', italian: '...e se ti aspetto a Roma?' },
    { original: 'I love you forever', italian: 'Ti amo per sempre' },
    { original: 'Juguemos para no desaparecer', italian: 'Giochiamo per non sparire' },
    { original: 'Está bien no estar bien', italian: 'Va bene non stare bene' },
    { original: 'Vivimos dentro de un sueño', italian: 'Viviamo dentro un sogno' },
    { original: 'Soñar contigo la vida', italian: 'Sognare con te la vita' },
    { original: 'Lembro de você', italian: 'Mi ricordo di te' },
    { original: 'Estoy cerca', italian: 'Sono vicino' },
    { original: 'Fuck nudes cook me ceviche', italian: 'Fanculo i nudi, cucinami il ceviche' },
    { original: 'Mucho sexo gay', italian: 'Molto sesso gay' },
    { original: 'Stop it', italian: 'Smettila' },
    { original: 'Sad people ruling the world', italian: 'Le persone tristi governano il mondo' },
    { original: 'Sorry about our president', italian: 'Scusa per il nostro presidente' },
    { original: 'Nómade de corazón', italian: 'Nomade di cuore' },
    { original: 'Wish you were gay', italian: 'Vorrei che tu fossi gay' },
    { original: 'Mis tetas son icónicas', italian: 'Le mie tette sono iconiche' },
    { original: 'Me gusta ver el mar contigo', italian: 'Mi piace vedere il mare con te' },
    { original: 'De amor no se vive', italian: 'D\'amore non si vive' },
    { original: 'Dejamos de soñarnos', italian: 'Abbiamo smesso di sognarci' },
    { original: 'Te perdí cuando te conocí', italian: 'Ti ho perso quando ti ho conosciuto' },
    { original: 'Me gusta caminar con vos', italian: 'Mi piace camminare con te' },
    { original: 'Our love still remains', italian: 'Il nostro amore rimane ancora' },
    { original: 'Siempre es una cuestión de piel', italian: 'È sempre una questione di pelle' },
    { original: 'Despiértame cuando estés a mi lado', italian: 'Svegliami quando sei al mio fianco' },
    { original: 'Contigo soy feliz', italian: 'Con te sono felice' },
    { original: 'Te esperaría toda la vida', italian: 'Ti aspetterei tutta la vita' },
    { original: 'Sueña conmigo', italian: 'Sogna con me' },
    { original: 'No somos perfectos', italian: 'Non siamo perfetti' },
    { original: 'Contigo siempre es real', italian: 'Con te è sempre reale' },
    { original: 'Tú y yo el planeta', italian: 'Tu e io il pianeta' },
    { original: 'Yo no creo en el amor', italian: 'Io non credo nell\'amore' },
    { original: 'Yo creo en nosotros', italian: 'Io credo in noi' },
    { original: 'Bailemos solos', italian: 'Balliamo da soli' },
    { original: 'Estar vivo es un peligro', italian: 'Essere vivi è un pericolo' },
    { original: 'No lloro más', italian: 'Non piango più' },
    { original: 'El cuerpo se me desangra', italian: 'Il corpo mi sanguina' },
    { original: 'No me gustan las despedidas', italian: 'Non mi piacciono gli addii' },
    { original: 'La felicidad también está en otras camas', italian: 'La felicità è anche in altri letti' },
    { original: 'No vuelvas más', italian: 'Non tornare più' },
    { original: 'Nada es para siempre', italian: 'Niente è per sempre' },
    { original: 'Tú y yo somos carne', italian: 'Tu e io siamo carne' },
    { original: 'Siempre estamos en ningún lugar', italian: 'Siamo sempre in nessun posto' },
    { original: 'Love me', italian: 'Amami' },
    { original: 'I don\'t need another hero', italian: 'Non ho bisogno di un altro eroe' },
    { original: 'Hoy voy a detener el tiempo', italian: 'Oggi fermerò il tempo' },
    { original: 'Todos queremos ser una Rosa', italian: 'Tutti vogliamo essere una Rosa' },
    { original: 'Abrazos eternos', italian: 'Abbracci eterni' },
    { original: 'Como me mirabas es mi tatuaje favorito', italian: 'Come mi guardavi è il mio tatuaggio preferito' },
    { original: 'Promete que siempre volverás', italian: 'Prometti che tornerai sempre' },
    { original: 'Jamás me iré', italian: 'Non me ne andrò mai' },
    { original: 'Picnics eternos', italian: 'Picnic eterni' },
    { original: 'Ya no siento nada', italian: 'Non sento più niente' },
    { original: 'También soy nada', italian: 'Anch\'io sono nulla' },
    { original: 'Quédate conmigo', italian: 'Resta con me' },
    { original: 'No me robes los sueños', italian: 'Non rubarmi i sogni' },
    { original: 'Sigo dormida', italian: 'Sono ancora addormentata' },
    { original: 'Sigo viviendo sin tu amor', italian: 'Continuo a vivere senza il tuo amore' },
    { original: 'I have a great love', italian: 'Ho un grande amore' },
    { original: 'Se me perdió tu mundo feliz', italian: 'Ho perso il tuo mondo felice' },
    { original: 'No quiero tenerte', italian: 'Non voglio averti' },
    { original: 'Olvídame', italian: 'Dimenticami' },
    { original: 'Tengo que dar más', italian: 'Devo dare di più' },
    { original: 'Regreso siempre', italian: 'Torno sempre' },
    { original: 'Mi corazón te vomita', italian: 'Il mio cuore ti vomita' },
    { original: 'Quiero que aparezcas', italian: 'Voglio che tu appaia' },
    { original: 'Dónde está tu cama?', italian: 'Dov\'è il tuo letto?' },
    { original: 'Intentar ser feliz', italian: 'Cercare di essere felice' },
    { original: 'Hay algo en el viento', italian: 'C\'è qualcosa nel vento' },
    { original: 'Éramos felices', italian: 'Eravamo felici' },
    { original: 'Éramos eternos', italian: 'Eravamo eterni' },
    { original: 'Siento amor', italian: 'Sento amore' },
    { original: 'Todo es más lento', italian: 'Tutto è più lento' },
    { original: 'El amor te ciega todo', italian: 'L\'amore ti acceca tutto' },
    { original: 'Yo no sirvo para amar', italian: 'Io non sono fatto per amare' },
    { original: 'Saudade', italian: 'Nostalgia dolce' },
    { original: 'Sobrevivo', italian: 'Sopravvivo' },
    { original: 'I miss you', italian: 'Mi manchi' },
    { original: 'Todos somos iguales', italian: 'Siamo tutti uguali' },
    { original: 'No me quieran', italian: 'Non vogliatemi bene' },
    { original: 'No me extrañen', italian: 'Non sentitemi la mancanza' },
    { original: 'No me piensen', italian: 'Non pensatemi' },
    { original: 'No soy de aquí', italian: 'Non sono di qui' },
    { original: 'Me gusta el amor', italian: 'Mi piace l\'amore' },
    { original: 'Sueño en otro idioma', italian: 'Sogno in un\'altra lingua' },
    { original: 'Tengo una tormenta en el cuerpo', italian: 'Ho una tempesta nel corpo' },
    { original: 'Quiero dormirnos', italian: 'Voglio che ci addormentiamo' },
    { original: 'Volvió el amor', italian: 'È tornato l\'amore' },
    { original: 'Respiro mal', italian: 'Respiro male' },
    { original: 'Creo en el silencio', italian: 'Credo nel silenzio' },
    { original: 'No hay vuelta atrás', italian: 'Non si torna indietro' },
    { original: 'Vuelo sin pensar', italian: 'Volo senza pensare' },
    { original: 'Me pesan los ojos', italian: 'Mi pesano gli occhi' },
    { original: 'Olvido todos mis sueños', italian: 'Dimentico tutti i miei sogni' },
    { original: 'Algún día seremos felices', italian: 'Un giorno saremo felici' },
    { original: 'No quiero ser famosa', italian: 'Non voglio essere famosa' },
    { original: 'No quiero trabajar', italian: 'Non voglio lavorare' },
    { original: 'Tears in my face', italian: 'Lacrime sul mio viso' },
    { original: 'I miss our home', italian: 'Mi manca la nostra casa' },
    { original: 'You\'re my favorite spot', italian: 'Sei il mio posto preferito' },
    { original: 'I don\'t want kids i want tattoos', italian: 'Non voglio figli, voglio tatuaggi' },
    { original: 'Let\'s daydream together', italian: 'Sogniamo ad occhi aperti insieme' },
    { original: 'You\'re my favorite mood', italian: 'Sei il mio umore preferito' },
    { original: 'Estamos hartas', italian: 'Ne abbiamo abbastanza' },
    { original: 'Se nos rompió el amor', italian: 'Il nostro amore si è rotto' },
    { original: 'I wanna be innocent again', italian: 'Voglio essere innocente di nuovo' },
    { original: 'Todo se pierde', italian: 'Tutto si perde' },
    { original: 'I wish i could disappear', italian: 'Vorrei poter sparire' },
    { original: 'You are good to me', italian: 'Sei buono con me' },
    { original: 'This is for us', italian: 'Questo è per noi' },
    { original: 'I\'m tired of waiting', italian: 'Sono stanco di aspettare' },
    { original: 'I\'m tired of staying awake', italian: 'Sono stanco di stare sveglio' },
    { original: 'I love you more than before', italian: 'Ti amo più di prima' },
    { original: 'Todo es una ilusión', italian: 'Tutto è un\'illusione' },
    { original: 'Dream on my tits', italian: 'Sogna sul mio petto' },
    { original: 'Extra cama con vos', italian: 'Letto extra con te' },
    { original: 'No me mires', italian: 'Non guardarmi' },
    { original: 'Flasheame', italian: 'Illuminami' },
    { original: 'I think you have something for me', italian: 'Penso che tu abbia qualcosa per me' },
    { original: 'You are my mango', italian: 'Sei il mio mango' },
    { original: 'Berries son mis drogas', italian: 'I frutti di bosco sono la mia droga' },
    { original: 'Tears with coffee', italian: 'Lacrime con caffè' },
    { original: 'Ya fue el arte', italian: 'L\'arte è finita' },
    { original: 'Me gusta verte', italian: 'Mi piace vederti' },
    { original: 'No duermo del lado del corazón', italian: 'Non dormo dal lato del cuore' },
    { original: 'Todes les amores', italian: 'Tutti gli amori' },
    { original: 'Yo soy el futuro', italian: 'Io sono il futuro' },
    { original: 'Todo cambia', italian: 'Tutto cambia' },
    { original: 'No pienso', italian: 'Non penso' },
    { original: 'No somos nada', italian: 'Non siamo niente' },
    { original: 'No somos nadie', italian: 'Non siamo nessuno' },
    { original: 'Soy feliz', italian: 'Sono felice' },
    { original: 'Me gusta el error', italian: 'Mi piace l\'errore' },
    { original: 'Somos soledad', italian: 'Siamo solitudine' },
    { original: 'Se busca mecenas', italian: 'Cercasi mecenate' },
    { original: 'Extraño extrañarte', italian: 'Mi manca mancarti' },
    { original: 'You have a great future', italian: 'Hai un grande futuro' },
    { original: 'Make me squirt', italian: 'Fammi godere' },
    { original: 'I wanna squirt you', italian: 'Voglio farti godere' },
    { original: 'Art makes us more human', italian: 'L\'arte ci rende più umani' },
    { original: 'I changed my life', italian: 'Ho cambiato la mia vita' },
    { original: 'You were the love of my life', italian: 'Eri l\'amore della mia vita' },
    { original: 'I hope you dance', italian: 'Spero che tu balli' },
    { original: 'Self care all the time everyday', italian: 'Prenditi cura di te sempre ogni giorno' },
    { original: 'Tu eres mi omega - Ω - ohm', italian: 'Tu sei la mia omega - Ω - ohm' },
    { original: 'No quiero un amor sin ternura', italian: 'Non voglio un amore senza tenerezza' },
    { original: 'The sky in my heart', italian: 'Il cielo nel mio cuore' },
    { original: 'Bitch, i know you know', italian: 'Bitch, lo so che lo sai' },
    { original: 'I smell you on my skin', italian: 'Ti sento sulla mia pelle' },
    { original: 'I breathe you', italian: 'Ti respiro' },
    { original: 'I wait for you', italian: 'Ti aspetto' },
    { original: 'I see you', italian: 'Ti vedo' },
    { original: 'Quiero revolución', italian: 'Voglio la rivoluzione' },
    { original: 'I love every time with you', italian: 'Amo ogni momento con te' },
    { original: 'I hope we laugh a lot together', italian: 'Spero che ridiamo tanto insieme' },
    { original: 'I\'m not sad i\'m very disappointed everyday', italian: 'Non sono triste, sono molto deluso ogni giorno' },
    { original: 'When is mañana?', italian: 'Quando è domani?' },
    { original: 'Rancia y mamada', italian: 'Rancida e ubriaca' },
    { original: 'I have nothing to say to anyone', italian: 'Non ho niente da dire a nessuno' },
    { original: 'No existe un mundo para los dos', italian: 'Non esiste un mondo per due' },
    { original: 'Tengamos una siesta eterna', italian: 'Facciamo un pisolino eterno' },
    { original: 'Los sueños no son eternos', italian: 'I sogni non sono eterni' },
    { original: 'Me gustaría bailarte', italian: 'Mi piacerebbe ballarti' },
    { original: 'No quiero corazones virtuales', italian: 'Non voglio cuori virtuali' },
    { original: 'Volems esta noche', italian: 'Voliamo stanotte' },
    { original: 'Murió la flor', italian: 'Il fiore è morto' },
    { original: 'Todos mienten', italian: 'Tutti mentono' },
    { original: 'No estamos solos', italian: 'Non siamo soli' },
    { original: 'Ven por mí', italian: 'Vieni a prendermi' },
    { original: 'No me censures', italian: 'Non censurarmi' },
    { original: 'Je suis tarde', italian: 'Sono in ritardo' },
    { original: 'Nada es necesario', italian: 'Niente è necessario' },
    { original: 'Todo se parece', italian: 'Tutto si assomiglia' },
    { original: 'Todos vuelven siempre', italian: 'Tutti tornano sempre' },
    { original: 'Quiero ir con vos', italian: 'Voglio venire con te' },
    { original: 'Llévame lejos', italian: 'Portami lontano' },
    { original: 'Let everything happen to you', italian: 'Lascia che tutto ti accada' },
    { original: 'No feeling is final', italian: 'Nessun sentimento è definitivo' },
    { original: 'I love myself', italian: 'Mi amo' },
    { original: 'Siempre te esperé', italian: 'Ti ho sempre aspettato' },
    { original: 'Llévame a Plutón', italian: 'Portami su Plutone' },
    { original: 'Vacation forever', italian: 'Vacanza per sempre' },
    { original: 'I don\'t remember my name', italian: 'Non ricordo il mio nome' },
    { original: 'No me tomes en serio', italian: 'Non prendermi sul serio' },
    { original: 'Las cosas me pierden', italian: 'Le cose mi perdono' },
    { original: 'El corazón es una piedra', italian: 'Il cuore è una pietra' },
    { original: 'Afecto efecto', italian: 'Affetto effetto' },
    { original: 'Mi cuerpo es una tumba', italian: 'Il mio corpo è una tomba' },
    { original: 'Tengo falsos recuerdos', italian: 'Ho falsi ricordi' },
    { original: 'Live life and don\'t let life live you', italian: 'Vivi la vita e non lasciare che la vita viva te' },
    { original: 'Happy tears happy tits', italian: 'Lacrime felici, seno felice' },
    { original: 'Let\'s keep finding ourselves', italian: 'Continuiamo a trovarci' },
    { original: 'It takes time to be', italian: 'Ci vuole tempo per essere' },
    { original: 'I just wanna wake up with you', italian: 'Voglio solo svegliarmi con te' },
    { original: 'Let\'s screw it up', italian: 'Roviniamolo' },
    { original: 'Te extraño mi amor', italian: 'Mi manchi amore mio' },
    { original: 'Yo me voy contigo a matar', italian: 'Me ne vado con te a uccidere' },
    { original: 'Quiero hacer todo', italian: 'Voglio fare tutto' },
    { original: 'Keep calm', italian: 'Mantieni la calma' },
    { original: 'Meet me half way', italian: 'Vienimi incontro a metà strada' },
    { original: 'Deseo desear', italian: 'Desidero desiderare' },
    { original: 'Nostalgia futura', italian: 'Nostalgia futura' },
    { original: 'Ya estás volviendo?', italian: 'Stai già tornando?' },
    { original: 'Fiesta y desamor', italian: 'Festa e disamore' },
    { original: 'Nuestro amor es plástico', italian: 'Il nostro amore è di plastica' },
    { original: 'Extraño la noche', italian: 'Mi manca la notte' },
    { original: 'Me quedo contigo', italian: 'Resto con te' },
    { original: 'Bailemos', italian: 'Balliamo' },
    { original: 'Nos están alejando', italian: 'Ci stanno allontanando' },
    { original: 'Estamos juntos', italian: 'Siamo insieme' },
    { original: 'Volveremos', italian: 'Torneremo' },
    { original: 'Nos quieren callar', italian: 'Vogliono farci tacere' },
    { original: 'Déjame tu recuerdo', italian: 'Lasciami il tuo ricordo' },
    { original: 'Siempre tú', italian: 'Sempre tu' },
    { original: 'La eternidad es ahora', italian: 'L\'eternità è adesso' },
    { original: 'Sin plata no puedo pensar', italian: 'Senza soldi non riesco a pensare' },
    { original: 'También somos lo que hemos perdido', italian: 'Siamo anche ciò che abbiamo perso' },
    { original: 'Sbored', italian: 'Sbored' },
    { original: 'Destroy time', italian: 'Distruggi il tempo' },
    { original: 'We are made of dreams', italian: 'Siamo fatti di sogni' },
    { original: 'Te amo aunque no te bañes', italian: 'Ti amo anche se non ti fai il bagno' },
    { original: 'No me baño', italian: 'Non mi faccio il bagno' },
    { original: 'Se murió la tristeza', italian: 'La tristezza è morta' },
    { original: 'El infinito está en vos', italian: 'L\'infinito è in te' },
    { original: 'I don\'t feel it like you see it', italian: 'Non lo sento come lo vedi tu' },
    { original: 'Aquí está el mar', italian: 'Qui c\'è il mare' },
    { original: 'Eres un amor irracional', italian: 'Sei un amore irrazionale' },
    { original: 'Vendo mi ego', italian: 'Vendo il mio ego' },
    { original: 'Tell her you love her dick', italian: 'Dille che ami il suo cazzo' },
    { original: 'No estamos rotos', italian: 'Non siamo rotti' },
    { original: 'There is always hope', italian: 'C\'è sempre speranza' },
    { original: 'Your heart\'s between the mountains', italian: 'Il tuo cuore è tra le montagne' },
    { original: 'Everything between us is amazing', italian: 'Tutto tra noi è meraviglioso' },
    { original: 'Dame un vinito tonight', italian: 'Dammi un vinetto stanotte' },
    { original: 'I want to be ok already', italian: 'Voglio già stare bene' },
    { original: 'I just want to enjoy life', italian: 'Voglio solo godermi la vita' },
    { original: 'Work and don\'t post', italian: 'Lavora e non postare' },
    { original: 'Todo o nada', italian: 'Tutto o niente' },
    { original: 'Eventually everything connects', italian: 'Alla fine tutto si connette' },
    { original: 'Freakin tired', italian: 'Maledettamente stanco' },
    { original: 'Queer as fuck', italian: 'Queer da morire' },
    { original: 'I can\'t stop scrolling', italian: 'Non riesco a smettere di scorrere' },
    { original: 'Sorry i don\'t speak hetero', italian: 'Scusa non parlo etero' },
    { original: 'Flowers and clona', italian: 'Fiori e clonazepam' },
    { original: 'Be glücklich', italian: 'Sii felice' },
    { original: 'Mi casa eres tú', italian: 'La mia casa sei tu' },
    { original: 'Sometimes i think and sit', italian: 'A volte penso e mi siedo' },
    { original: 'I don\'t suffer for love anymore', italian: 'Non soffro più per amore' },
    { original: 'Always got your back', italian: 'Sono sempre dalla tua parte' },
    { original: 'Don\'t walk away', italian: 'Non andare via' },
    { original: 'Let\'s be people', italian: 'Siamo persone' },
    { original: 'I think I\'m ok because I\'m alive', italian: 'Penso di stare bene perché sono vivo' },
    { original: 'Yo soy el universo', italian: 'Io sono l\'universo' },
    { original: 'Just do it', italian: 'Fallo e basta' },
    { original: 'Feelings are facts', italian: 'I sentimenti sono fatti' },
    { original: 'My love language is being weird', italian: 'Il mio linguaggio d\'amore è essere strano' },
    { original: 'Nadie es hetero', italian: 'Nessuno è etero' },
    { original: 'Punk y anarquista', italian: 'Punk e anarchico' },
    { original: 'I\'m too tired', italian: 'Sono troppo stanco' },
    { original: 'I love to get messy with you', italian: 'Amo fare casino con te' },
    { original: 'Sad girl since 5', italian: 'Ragazza triste dai 5 anni' },
    { original: 'There\'s a fire in our hearts', italian: 'C\'è un fuoco nei nostri cuori' },
    { original: 'Yo te voy a cuidar', italian: 'Mi prenderò cura di te' },
    { original: 'Keep working', italian: 'Continua a lavorare' },
    { original: 'Contact doesn\'t mean connection', italian: 'Il contatto non significa connessione' },
    { original: 'You are here but i miss you', italian: 'Sei qui ma mi manchi' },
    { original: 'Quiero boludear con vos', italian: 'Voglio fare fesserie con te' },
    { original: 'Make me love', italian: 'Fammi amare' },
    { original: 'Where we are?', italian: 'Dove siamo?' },
    { original: 'Where is love?', italian: 'Dov\'è l\'amore?' },
    { original: 'Soy un sol', italian: 'Sono un sole' },
    { original: 'Quiero vomitar', italian: 'Voglio vomitare' },
    { original: 'No me interesa', italian: 'Non mi interessa' },
    { original: 'Te regalo mi corazón', italian: 'Ti regalo il mio cuore' },
    { original: 'Nunca es tarde', italian: 'Non è mai tardi' },
    { original: 'Prohibido olvidar', italian: 'Vietato dimenticare' },
    { original: 'Vámonos de aquí', italian: 'Andiamocene da qui' },
    { original: 'El desamor nos va a matar', italian: 'Il disamore ci ucciderà' },
    { original: 'No te llores', italian: 'Non piangerti' },
    { original: 'Can we fall in love this spring?', italian: 'Possiamo innamorarci questa primavera?' },
    { original: 'También estoy aquí', italian: 'Sono anche io qui' },
    { original: 'No quiero perderte', italian: 'Non voglio perderti' },
    { original: 'Quiero perderme contigo', italian: 'Voglio perdermi con te' },
    { original: 'Ven conmigo siempre', italian: 'Vieni con me sempre' },
    { original: 'Nos extraño', italian: 'Mi mancano noi' },
    { original: 'Esto no se vende', italian: 'Questo non si vende' },
    { original: 'Nos quiero a nosotros', italian: 'Voglio bene a noi' },
    { original: 'Seamos infinitos', italian: 'Siamo infiniti' },
    { original: 'Me cansé de soñarte', italian: 'Mi sono stancato di sognarti' },
    { original: 'Mi corazón duele', italian: 'Il mio cuore fa male' },
    { original: 'Dame fantasía', italian: 'Dammi fantasia' },
    { original: 'Quiero ser tu vicio', italian: 'Voglio essere il tuo vizio' },
    { original: 'El futuro es ahora', italian: 'Il futuro è adesso' },
    { original: 'Seamos fugaces', italian: 'Siamo fugaci' },
    { original: 'Me rompí el corazón', italian: 'Mi sono rotto il cuore' },
    { original: 'Prefiero no saber', italian: 'Preferisco non sapere' },
    { original: 'Yo también quiero', italian: 'Anch\'io voglio' },
    { original: 'Camíname por todo el cuerpo', italian: 'Cammina su tutto il mio corpo' },
    { original: 'Un cuartito para los dos', italian: 'Una stanzina per noi due' },
    { original: 'Ya existe todo', italian: 'Tutto esiste già' },
    { original: 'Salvémonos solos', italian: 'Salviamoci da soli' },
    { original: 'Te quiero seguir', italian: 'Voglio continuare a seguirti' },
    { original: 'Quiero oler como vos', italian: 'Voglio odorare come te' },
    { original: 'Me olvidaste de nuevo', italian: 'Mi hai dimenticato di nuovo' },
    { original: 'Me haces llorar', italian: 'Mi fai piangere' },
    { original: 'Quiero acordar contigo', italian: 'Voglio accordarmi con te' },
    { original: 'Te encontré', italian: 'Ti ho trovato' },
    { original: 'Quiero volver', italian: 'Voglio tornare' },
    { original: 'Vuela conmigo', italian: 'Vola con me' },
    { original: 'Terminemos mal', italian: 'Finiamola male' },
    { original: 'No me esperes', italian: 'Non aspettarmi' },
    { original: 'Soñé que era verano', italian: 'Ho sognato che era estate' },
    { original: 'Termino mirándote', italian: 'Finisco a guardarti' },
    { original: 'Soy tu carne', italian: 'Sono la tua carne' },
    { original: 'No siento tu piel', italian: 'Non sento la tua pelle' },
    { original: 'Somos un amor infinito', italian: 'Siamo un amore infinito' },
    { original: 'Soy tu chica', italian: 'Sono la tua ragazza' },
    { original: 'Me gusta esperarte', italian: 'Mi piace aspettarti' },
    { original: 'El invierno no sé', italian: 'L\'inverno non so' },
    { original: 'No me llores', italian: 'Non piangermi' },
    { original: 'Ya no quiero jugar', italian: 'Non voglio più giocare' },
    { original: 'Prefiero hablar sola', italian: 'Preferisco parlare da sola' },
    { original: 'Lo vimos todo', italian: 'Abbiamo visto tutto' },
    { original: 'Regálame tu horizonte', italian: 'Regalami il tuo orizzonte' },
    { original: 'Sácame la piel', italian: 'Toglimi la pelle' },
    { original: 'Olvidémonos siempre', italian: 'Dimentichiamoci sempre' },
    { original: 'Quédate conmigo', italian: 'Resta con me' },
    { original: 'Déjame buscarte', italian: 'Lasciami cercarti' },
    { original: 'Hoy voy a hacer algo', italian: 'Oggi farò qualcosa' },
    { original: 'Me tienes?', italian: 'Mi hai?' },
    { original: 'Esto está de más', italian: 'Questo è di troppo' },
    { original: 'No me dejes regresar', italian: 'Non lasciarmi tornare' },
    { original: 'Es mejor que no exista', italian: 'È meglio che non esista' },
    { original: 'Soñé que te quería', italian: 'Ho sognato che ti amavo' },
    { original: 'No soy una extraña', italian: 'Non sono una estranea' },
    { original: 'Tu piel está muda', italian: 'La tua pelle è muta' },
    { original: 'Yo no fui', italian: 'Io non l\'ho fatto' },
    { original: 'Bésame mucho', italian: 'Baciami molto' },
    { original: 'Regresa siempre', italian: 'Torna sempre' },
    { original: 'No me putees', italian: 'Non imprecare contro di me' },
    { original: 'No me rompas', italian: 'Non spezzarmi' },
    { original: 'Quiero querer', italian: 'Voglio volere' },
    { original: 'No me olvides', italian: 'Non dimenticarmi' },
    { original: 'No me ames', italian: 'Non amarmi' },
    { original: 'Mañana no existe', italian: 'Il domani non esiste' },
    { original: 'Después es nunca', italian: 'Dopo è mai' },
    { original: 'Déjame decirte algo', italian: 'Lasciami dirti una cosa' },
    { original: 'Dame más', italian: 'Dammi di più' },
    { original: 'Seamos amantes eternos', italian: 'Siamo amanti eterni' },
    { original: 'Esto no me sirve más', italian: 'Questo non mi serve più' },
    { original: 'Un día voy a llorar', italian: 'Un giorno piangerò' },
    { original: 'No quiero más amores de verano', italian: 'Non voglio più amori estivi' },
    { original: 'Quiero tu eternidad', italian: 'Voglio la tua eternità' },
    { original: 'Quiero ser tu secreto', italian: 'Voglio essere il tuo segreto' },
    { original: 'No quiero bailarte', italian: 'Non voglio ballarti' },
    { original: 'Cruzo el mar para verte', italian: 'Attraverso il mare per vederti' },
    { original: 'Quiero ser un meme', italian: 'Voglio essere un meme' },
    { original: 'Yo vi tu corazón', italian: 'Ho visto il tuo cuore' },
    { original: 'Fica mais perto', italian: 'Stai più vicino' },
    { original: 'Llueve en mí', italian: 'Piove in me' },
    { original: 'Léeme todo', italian: 'Leggimi tutto' },
    { original: 'Busquémonos otra vez', italian: 'Cerchiamoci di nuovo' },
    { original: 'Dame todo', italian: 'Dammi tutto' },
    { original: 'Siempre estás conmigo', italian: 'Sei sempre con me' },
    { original: 'Quédate esta noche', italian: 'Resta stanotte' },
    { original: 'Internet is my lover', italian: 'Internet è il mio amante' },
    { original: 'Estamos perdidos', italian: 'Siamo perduti' },
    { original: 'Perdura conmigo', italian: 'Perdura con me' },
    { original: 'Renunciemos todos', italian: 'Rinunciamo tutti' },
    { original: 'Bailemos solos', italian: 'Balliamo da soli' },
    { original: 'Aquí te espero siempre', italian: 'Ti aspetto sempre qui' },
    { original: 'Búscame', italian: 'Cercami' },
    { original: 'Siempre nos imagino bailando', italian: 'Vi immagino sempre che ballate' },
    { original: 'Stalkéame', italian: 'Stalkerami' },
    { original: 'Hagamos magia', italian: 'Facciamo magia' },
    { original: 'Devuélveme el corazón', italian: 'Restituiscimi il cuore' },
    { original: 'No quiero ser alguien', italian: 'Non voglio essere qualcuno' },
    { original: 'Quiero ser una rosa', italian: 'Voglio essere una rosa' },
    { original: 'Quítame todo', italian: 'Toglimi tutto' },
    { original: 'Me invades', italian: 'Mi invadi' },
    { original: 'Hagamos nada', italian: 'Non facciamo niente' },
    { original: 'Me mataste', italian: 'Mi hai ucciso' },
    { original: 'Siempre quiero nada', italian: 'Voglio sempre niente' },
    { original: 'No sé olvidar', italian: 'Non so dimenticare' },
    { original: 'Otro amor vendrá', italian: 'Un altro amore verrà' },
    { original: 'Quiero regresar', italian: 'Voglio tornare' },
    { original: 'Seamos felices', italian: 'Siamo felici' },
    { original: 'Llévame a donde quieras', italian: 'Portami dove vuoi' },
    { original: 'Pruébame', italian: 'Provami' },
    { original: 'No soy un robot', italian: 'Non sono un robot' },
    { original: 'Never stop', italian: 'Non fermarti mai' },
    { original: 'No soy nada', italian: 'Non sono niente' },
    { original: 'Volvámonos nada', italian: 'Diventiamo niente' },
    { original: 'Actualízame', italian: 'Aggiornami' },
    { original: 'No existimos', italian: 'Non esistiamo' },
    { original: 'Mi noche es tu mañana', italian: 'La mia notte è il tuo mattino' },
    { original: 'Sacas lo peor de mí', italian: 'Tiri fuori il peggio di me' },
    { original: 'Espero que no vengas', italian: 'Spero che non venga' },
    { original: 'Llegaste tarde', italian: 'Sei arrivato tardi' },
    { original: 'Te maté', italian: 'Ti ho ucciso' },
    { original: 'No existe la noche', italian: 'La notte non esiste' },
    { original: 'Lloro por vos', italian: 'Piango per te' },
    { original: 'Empecemos pero no paremos', italian: 'Iniziamo ma non fermiamoci' },
    { original: 'Te vomité', italian: 'Ti ho vomitato' },
    { original: 'Me gustan todos', italian: 'Mi piacciono tutti' },
    { original: 'Te quiero conmigo', italian: 'Ti voglio con me' },
    { original: 'Solo tú', italian: 'Solo tu' },
    { original: 'Traté de caminarte', italian: 'Ho cercato di camminare su di te' },
    { original: 'No quise borrarte', italian: 'Non ho voluto cancellarti' },
    { original: 'Hagámoslo rápido', italian: 'Facciamolo in fretta' },
    { original: 'No quiero tu amor', italian: 'Non voglio il tuo amore' },
    { original: 'Quiero más novios', italian: 'Voglio più fidanzati' },
    { original: 'Caminemos desnudos', italian: 'Camminiamo nudi' },
    { original: 'Soñé que te soñaba', italian: 'Ho sognato che ti sognavo' },
    { original: 'Sobredosis de amor efímero', italian: 'Overdose di amore effimero' },
    { original: 'No quiero más historias', italian: 'Non voglio più storie' },
    { original: 'Colecciono olvidos', italian: 'Colleziono obli' },
    { original: 'Suicídame', italian: 'Suicidami' },
    { original: 'Solo quiero mirar', italian: 'Voglio solo guardare' },
    { original: 'Me escondo en ti', italian: 'Mi nascondo in te' },
    { original: 'Tocarte es una ilusión', italian: 'Toccarti è un\'illusione' },
    { original: 'Cánsame', italian: 'Stancami' },
    { original: 'Olvido tu ausencia', italian: 'Dimentico la tua assenza' },
    { original: 'No hables de ti', italian: 'Non parlare di te' },
    { original: 'También quiero gritar', italian: 'Anch\'io voglio urlare' },
    { original: 'Esta vez prometo llorar', italian: 'Questa volta prometto di piangere' },
    { original: 'Un ratito más', italian: 'Un altro pochino' },
    { original: 'Te veo como nunca te vi', italian: 'Ti vedo come non ti ho mai visto' },
    { original: 'Olvidé soñar', italian: 'Ho dimenticato di sognare' },
    { original: 'Siempre alguien te mira', italian: 'Qualcuno ti guarda sempre' },
    { original: 'Salí a buscarte', italian: 'Sono uscito a cercarti' },
    { original: 'No me canso de tu voz', italian: 'Non mi stanco della tua voce' },
    { original: 'Te quiero chapar', italian: 'Ti voglio baciare' },
    { original: 'Sos mi sueño', italian: 'Sei il mio sogno' },
    { original: 'Somos una prueba de amor', italian: 'Siamo una prova d\'amore' },
    { original: 'El amor vende', italian: 'L\'amore vende' },
    { original: 'Don\'t forget me', italian: 'Non dimenticarmi' },
    { original: 'Quiero estar calata', italian: 'Voglio stare nuda' },
    { original: 'Let\'s try to live forever', italian: 'Proviamo a vivere per sempre' },
    { original: 'Siempre al mar', italian: 'Sempre al mare' },
    { original: 'Siempre amar', italian: 'Amare sempre' },
    { original: 'You make me dizzy', italian: 'Mi fai girare la testa' },
    { original: 'Las lenguas se abrazan', italian: 'Le lingue si abbracciano' },
    { original: 'I want more', italian: 'Voglio di più' },
    { original: 'Unfuck the world', italian: 'Aggiusta il mondo' },
    { original: 'Amor sin límite', italian: 'Amore senza limiti' },
    { original: 'I think i love u', italian: 'Penso di amarti' },
    { original: 'Do what u love', italian: 'Fa\' quello che ami' },
    { original: 'Vos sos las estrellas', italian: 'Tu sei le stelle' },
    { original: 'The future is ladyboy', italian: 'Il futuro è ladyboy' },
    { original: 'Go deep', italian: 'Vai in profondità' },
    { original: 'Keep doing what you\'re doing', italian: 'Continua a fare quello che stai facendo' },
    { original: 'Todo se cae', italian: 'Tutto crolla' },
    { original: 'Everything is alive', italian: 'Tutto è vivo' },
    { original: 'I make my dreams come true', italian: 'Realizzo i miei sogni' },
    { original: 'El miedo va a cambiar de mando', italian: 'La paura cambierà di mano' },
    { original: 'Work hard play harder', italian: 'Lavora duro, divertiti di più' },
    { original: 'Don\'t wait', italian: 'Non aspettare' },
    { original: 'You are my portal', italian: 'Sei il mio portale' },
    { original: 'Yo también soy el mar', italian: 'Anch\'io sono il mare' },
    { original: 'Let\'s end the world together', italian: 'Finiamo il mondo insieme' },
    { original: 'We are the nightlife', italian: 'Siamo la vita notturna' },
    { original: 'Out of the blue', italian: 'All\'improvviso' },
    { original: 'Later is better', italian: 'Dopo è meglio' },
    { original: 'Be delight', italian: 'Sii delizia' },
    { original: 'Te llevo en la piel', italian: 'Ti porto nella pelle' },
    { original: 'You\'re my fantasy come true', italian: 'Sei la mia fantasia diventata realtà' },
    { original: 'I\'ll drink my love', italian: 'Berrò il mio amore' },
    { original: 'Te doy mi vida', italian: 'Ti do la mia vita' }
  ];

  var COLORS = [
    '#FFE234','#FFD600','#FF6FB7','#FF4D6D',
    '#FF8C42','#FFA552','#7ED957','#4CAF50',
    '#56CFE1','#4361EE','#9B5DE5','#C77DFF',
    '#F72585','#00B4D8'
  ];

  var INACTIVITY_MS = 35000;

  // --- STATE ---
  var state = {
    screen: 'code', postits: [], usedPhrases: [],
    currentPhrase: null, currentQuestion: null, currentColor: null,
    inactivityTimer: null, _placingNew: false, _newEl: null
  };

  // --- MULTI-USER STATE ---
  var wallId = null;
  var wallActive = false;
  var adminSecret = null;
  var myPendingIds = {};   // post-it IDs we inserted — skip realtime INSERT echo
  var draggingId = null;   // post-it ID currently being dragged locally

  // --- DRAG THROTTLE ---
  var dragThrottle = { lastTime: 0, pending: null };

  // --- DOM ---
  var $wall = document.getElementById('wall');
  var $wallUI = document.getElementById('wall-ui');
  var $reveal = document.getElementById('reveal-screen');
  var $loading = document.getElementById('loading-screen');
  var $counter = document.getElementById('counter');
  var $questionInput = document.getElementById('question-input');
  var $revealQuestion = document.getElementById('reveal-question');
  var $revealPostit = document.getElementById('reveal-postit');
  var $revealWrapper = document.getElementById('reveal-wrapper');
  var $placementHint = document.getElementById('placement-hint');
  var $codeScreen = document.getElementById('code-screen');
  var $codeInput = document.getElementById('code-input');
  var $codeError = document.getElementById('code-error');
  var $readonlyBanner = document.getElementById('readonly-banner');
  var $adminCloseBtn = document.getElementById('admin-close-btn');
  var $langPicker = document.getElementById('lang-picker');

  function wallW() { return window.innerWidth; }
  function wallH() { return window.innerHeight; }
  function postitSize() {
    return parseInt(getComputedStyle(document.documentElement).getPropertyValue('--postit-size'),10) || 90;
  }

  // --- LOCAL STORAGE (per-device prefs only) ---
  function loadLocalPrefs() {
    try {
      var u = localStorage.getItem('oracolo_usedPhrases');
      if (u) state.usedPhrases = JSON.parse(u);
      var l = localStorage.getItem('oracolo_lang');
      if (l && I18N[l]) currentLang = l;
    } catch (e) { state.usedPhrases = []; }
  }
  function saveUsedPhrases() { try { localStorage.setItem('oracolo_usedPhrases', JSON.stringify(state.usedPhrases)); } catch(e) {} }

  // --- PHRASE RENDERING ---
  function renderPhraseHTML(phraseStr) {
    var idx = phraseStr.indexOf('\n');
    if (idx === -1) return '<span class="postit-original">' + phraseStr + '</span>';
    var orig = phraseStr.substring(0, idx);
    var ita = phraseStr.substring(idx + 1);
    return '<span class="postit-original">' + orig + '</span>' +
           '<span class="postit-italian">' + ita + '</span>';
  }

  // --- PHRASES ---
  function selectPhrase() {
    if (state.usedPhrases.length >= FRASI.length) state.usedPhrases = [];
    var available = [];
    for (var i = 0; i < FRASI.length; i++) {
      if (state.usedPhrases.indexOf(i) === -1) available.push(i);
    }
    var idx = available[Math.floor(Math.random() * available.length)];
    state.usedPhrases.push(idx);
    saveUsedPhrases();
    return FRASI[idx];
  }
  function randomColor() { return COLORS[Math.floor(Math.random() * COLORS.length)]; }
  function generateRotation() { return -4 + Math.random() * 8; }

  // =============================================
  // SUPABASE — validate code, load wall, subscribe
  // =============================================
  async function validateCode(code) {
    var res = await sb.from('walls').select('*').eq('code', code.toUpperCase()).single();
    if (res.error || !res.data) return null;
    return res.data;
  }

  async function enterWall(wall) {
    wallId = wall.id;
    wallActive = wall.is_active;

    // Fetch existing post-its
    var res = await sb.from('postits')
      .select('*')
      .eq('wall_id', wallId)
      .order('created_at', { ascending: true });

    if (!res.error && res.data) {
      state.postits = res.data;
    }

    renderWall();
    $codeScreen.classList.add('hidden');

    if (wallActive) {
      showScreen('wall');
      subscribeRealtime();
      if (adminSecret) showAdminButton();
    } else {
      showScreen('wall');
      enterReadOnlyMode();
    }
  }

  // --- REALTIME ---
  function subscribeRealtime() {
    sb.channel('wall-' + wallId)
      .on('postgres_changes', {
        event: 'INSERT', schema: 'public', table: 'postits',
        filter: 'wall_id=eq.' + wallId
      }, handleRealtimeInsert)
      .on('postgres_changes', {
        event: 'UPDATE', schema: 'public', table: 'postits',
        filter: 'wall_id=eq.' + wallId
      }, handleRealtimeUpdate)
      .on('postgres_changes', {
        event: 'UPDATE', schema: 'public', table: 'walls',
        filter: 'id=eq.' + wallId
      }, handleWallUpdate)
      .subscribe();
  }

  function handleRealtimeInsert(payload) {
    var data = payload.new;
    if (!data) return;
    // Skip our own optimistic inserts
    if (myPendingIds[data.id]) {
      delete myPendingIds[data.id];
      return;
    }
    // Add to local state and render with animation
    state.postits.push(data);
    var el = createPostitElement(data, true);
    $wall.appendChild(el);
    updateCounter();
  }

  function handleRealtimeUpdate(payload) {
    var data = payload.new;
    if (!data) return;
    // Skip if we're currently dragging this post-it
    if (data.id === draggingId) return;
    // Smooth transition to new position
    var el = $wall.querySelector('[data-id="' + data.id + '"]');
    if (el) {
      el.style.transition = 'left 0.3s ease, top 0.3s ease';
      el.style.left = (data.x * 100) + '%';
      el.style.top = (data.y * 100) + '%';
      setTimeout(function() { el.style.transition = ''; }, 350);
    }
    // Update local state
    var pd = findPostitData(data.id);
    if (pd) { pd.x = data.x; pd.y = data.y; }
  }

  function handleWallUpdate(payload) {
    var data = payload.new;
    if (data && data.is_active === false && wallActive) {
      enterReadOnlyMode();
    }
  }

  // --- READ-ONLY MODE ---
  function enterReadOnlyMode() {
    wallActive = false;
    $wallUI.classList.add('hidden');
    $readonlyBanner.textContent = t('wallClosed');
    $readonlyBanner.classList.remove('hidden');
    $adminCloseBtn.classList.add('hidden');

    // Cancel active drag
    if (drag.active && drag.el) {
      drag.el.classList.remove('dragging');
      drag.active = false; drag.el = null;
    }
    // Cancel placement mode
    if (state._placingNew && state._newEl) {
      state._newEl.remove();
      state._placingNew = false; state._newEl = null;
    }
    $placementHint.classList.add('hidden');

    // Return to wall screen if on reveal
    if (state.screen === 'reveal') showScreen('wall');
  }

  // --- ADMIN ---
  function showAdminButton() {
    $adminCloseBtn.textContent = t('closeWall');
    $adminCloseBtn.classList.remove('hidden');
  }

  async function closeWall() {
    if (!confirm(t('closeConfirm'))) return;

    // Hide UI before screenshot
    $wallUI.classList.add('hidden');
    $langPicker.style.display = 'none';
    $adminCloseBtn.style.display = 'none';
    $readonlyBanner.classList.add('hidden');

    // Small delay for DOM to settle
    await new Promise(function(r) { setTimeout(r, 100); });

    // Take screenshot
    try {
      var canvas = await html2canvas($wall, { scale: 2, backgroundColor: '#ffffff' });
      var link = document.createElement('a');
      link.download = 'oracolo-maca-wall.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    } catch (e) {
      console.error('Screenshot error:', e);
    }

    // Restore visibility (will be handled by enterReadOnlyMode anyway)
    $langPicker.style.display = '';
    $adminCloseBtn.style.display = '';

    // Close wall via RPC
    var res = await sb.rpc('close_wall', { p_wall_id: wallId, p_secret: adminSecret });
    if (res.error) console.error('Close wall error:', res.error);

    // Enter read-only locally (realtime may also trigger this)
    enterReadOnlyMode();
  }

  // =============================================
  // WALL RENDERING
  // =============================================
  function createPostitElement(data, animate) {
    var el = document.createElement('div');
    el.className = 'postit' + (animate ? ' fly-in' : '');
    el.dataset.id = data.id;
    el.style.left = (data.x * 100) + '%';
    el.style.top = (data.y * 100) + '%';
    el.style.backgroundColor = data.color;
    el.style.transform = 'rotate(' + data.rotation + 'deg)';
    el.style.setProperty('--rot', data.rotation + 'deg');
    el.innerHTML = renderPhraseHTML(data.phrase);
    if (animate) {
      el.addEventListener('animationend', function () { el.classList.remove('fly-in'); }, { once: true });
    }
    return el;
  }

  function renderWall() {
    var existing = $wall.querySelectorAll('.postit');
    for (var i = 0; i < existing.length; i++) existing[i].remove();
    var frag = document.createDocumentFragment();
    for (var i = 0; i < state.postits.length; i++) frag.appendChild(createPostitElement(state.postits[i], false));
    $wall.appendChild(frag);
    updateCounter();
  }

  function updateCounter() { $counter.textContent = t('counter').replace('{n}', state.postits.length); }

  function findPostitData(id) {
    for (var i = 0; i < state.postits.length; i++) {
      if (String(state.postits[i].id) === String(id)) return state.postits[i];
    }
    return null;
  }

  // --- SCREENS ---
  function showScreen(name) {
    state.screen = name;
    clearInactivityTimer();
    $reveal.classList.toggle('hidden', name !== 'reveal');
    if (name === 'wall') {
      if (wallActive && !state._placingNew) $wallUI.classList.remove('hidden');
      updateCounter();
    } else {
      $wallUI.classList.add('hidden');
    }
    if (name === 'reveal') startInactivityTimer();
  }

  function startInactivityTimer() {
    clearInactivityTimer();
    state.inactivityTimer = setTimeout(function () {
      if (state.screen === 'reveal') showScreen('wall');
    }, INACTIVITY_MS);
  }
  function clearInactivityTimer() {
    if (state.inactivityTimer) { clearTimeout(state.inactivityTimer); state.inactivityTimer = null; }
  }
  function resetInactivity() {
    if (state.screen === 'reveal') startInactivityTimer();
  }

  // --- SUBMIT ---
  function submit() {
    if (!wallActive) return;
    var q = $questionInput.value && $questionInput.value.trim() ? $questionInput.value.trim() : null;
    state.currentQuestion = q;
    var p = selectPhrase();
    state.currentPhrase = p.original + '\n' + p.italian;
    state.currentColor = randomColor();

    if (q) {
      $revealQuestion.textContent = '\u201C' + q + '\u201D';
      $revealQuestion.style.display = '';
    } else {
      $revealQuestion.textContent = '';
      $revealQuestion.style.display = 'none';
    }
    $revealPostit.innerHTML = renderPhraseHTML(state.currentPhrase);
    $revealPostit.style.backgroundColor = state.currentColor;
    $revealPostit.classList.remove('pop');
    void $revealPostit.offsetWidth;
    $revealPostit.classList.add('pop');

    $questionInput.value = '';
    $questionInput.blur();
    showScreen('reveal');
  }

  // --- DRAG SYSTEM ---
  var drag = { active:false, el:null, id:null, isNew:false, offsetX:0, offsetY:0, moved:false };

  function startDrag(el, cx, cy, isNew) {
    if (!wallActive) return;
    drag.active=true; drag.el=el; drag.id=el.dataset.id||null;
    drag.isNew=isNew; drag.moved=false;
    var r=el.getBoundingClientRect();
    drag.offsetX=cx-r.left; drag.offsetY=cy-r.top;
    el.style.left=r.left+'px'; el.style.top=r.top+'px';
    el.classList.add('dragging');
    if (!isNew) draggingId = el.dataset.id;
    dragThrottle.lastTime = 0;
    dragThrottle.pending = null;
  }

  function moveDrag(cx, cy) {
    if (!drag.active||!drag.el) return;
    drag.moved=true;
    var s=postitSize();
    var nx=Math.max(0,Math.min(wallW()-s,cx-drag.offsetX));
    var ny=Math.max(0,Math.min(wallH()-s,cy-drag.offsetY));
    drag.el.style.left=nx+'px'; drag.el.style.top=ny+'px';

    // Throttled Supabase update for existing post-its
    if (!drag.isNew && drag.id) {
      var fx=Math.max(0,Math.min(0.95,nx/wallW()));
      var fy=Math.max(0,Math.min(0.95,ny/wallH()));
      var now=Date.now();
      if (now - dragThrottle.lastTime >= 200) {
        dragThrottle.lastTime = now;
        dragThrottle.pending = null;
        sb.from('postits').update({x:fx,y:fy}).eq('id',drag.id).then(function(){});
      } else {
        dragThrottle.pending = {id:drag.id, x:fx, y:fy};
      }
    }
  }

  function endDrag() {
    if (!drag.active||!drag.el) return;
    var el=drag.el;
    var px=parseInt(el.style.left,10), py=parseInt(el.style.top,10);
    var fx=Math.max(0,Math.min(0.95,px/wallW()));
    var fy=Math.max(0,Math.min(0.95,py/wallH()));
    el.classList.remove('dragging');

    if (drag.isNew) {
      var rot=generateRotation();
      var postitId = el.dataset.id;
      var d={
        id: postitId,
        wall_id: wallId,
        phrase: state.currentPhrase,
        question: state.currentQuestion,
        color: state.currentColor,
        x: fx, y: fy,
        rotation: rot,
        lang: currentLang
      };
      el.style.left=(fx*100)+'%'; el.style.top=(fy*100)+'%';
      el.style.transform='rotate('+rot+'deg)'; el.style.setProperty('--rot',rot+'deg');
      state.postits.push(d);
      myPendingIds[postitId] = true;
      updateCounter();

      // Insert into Supabase
      sb.from('postits').insert({
        id: d.id, wall_id: d.wall_id, phrase: d.phrase,
        question: d.question, color: d.color,
        x: d.x, y: d.y, rotation: d.rotation, lang: d.lang
      }).then(function(res) {
        if (res.error) console.error('Insert error:', res.error);
      });

      $placementHint.classList.add('hidden');
      if (wallActive) $wallUI.classList.remove('hidden');
    } else if (drag.moved) {
      var pd=findPostitData(drag.id);
      if (pd) {
        pd.x=fx; pd.y=fy;
        el.style.left=(fx*100)+'%'; el.style.top=(fy*100)+'%';
        el.style.transform='rotate('+pd.rotation+'deg)';

        // Flush final position to Supabase
        if (dragThrottle.pending) dragThrottle.pending = null;
        sb.from('postits').update({x:fx,y:fy}).eq('id',drag.id).then(function(res){
          if (res.error) console.error('Update error:', res.error);
        });
      }
    } else {
      // No movement — restore original position
      var ed=findPostitData(drag.id);
      if (ed) {
        el.style.left=(ed.x*100)+'%'; el.style.top=(ed.y*100)+'%';
        el.style.transform='rotate('+ed.rotation+'deg)';
      }
    }

    draggingId = null;
    drag.active=false; drag.el=null; drag.id=null; drag.isNew=false; drag.moved=false;
  }

  function startPlacement() {
    showScreen('wall');
    $wallUI.classList.add('hidden');
    $placementHint.classList.remove('hidden');
    var id = crypto.randomUUID();
    var d={id:id, phrase:state.currentPhrase, question:state.currentQuestion,
      color:state.currentColor, x:0.45, y:0.45, rotation:0};
    var el=createPostitElement(d,false);
    el.classList.add('dragging');
    $wall.appendChild(el);
    state._newEl=el; state._placingNew=true;
  }

  // =============================================
  // CODE SCREEN
  // =============================================
  function showCodeScreen(errorMsg) {
    $codeScreen.classList.remove('hidden');
    $wallUI.classList.add('hidden');
    $codeError.textContent = errorMsg || '';
    state.screen = 'code';
  }

  async function onCodeSubmit() {
    var code = $codeInput.value.trim().toUpperCase();
    if (!code) return;
    $codeError.textContent = '';
    $codeInput.disabled = true;

    var wall = await validateCode(code);
    $codeInput.disabled = false;

    if (wall) {
      // Add code to URL for sharing
      var url = new URL(window.location);
      url.searchParams.set('code', code);
      history.replaceState(null, '', url);
      await enterWall(wall);
    } else {
      $codeError.textContent = t('codeError');
      $codeInput.focus();
    }
  }

  // --- LISTENERS ---
  function setup() {
    // Lang
    var lbs=document.querySelectorAll('.lang-btn');
    for (var i=0;i<lbs.length;i++) lbs[i].addEventListener('click',function(e){e.stopPropagation();setLang(this.dataset.lang);});

    // Submit
    document.getElementById('submit-btn').addEventListener('click',function(e){e.stopPropagation();submit();});
    $questionInput.addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();submit();}});

    // Code submit
    document.getElementById('code-submit-btn').addEventListener('click',function(e){e.stopPropagation();onCodeSubmit();});
    $codeInput.addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();onCodeSubmit();}});

    // Reveal
    document.getElementById('paste-btn').addEventListener('click',function(e){e.stopPropagation();startPlacement();});
    $reveal.addEventListener('click',function(e){if(e.target===$reveal)showScreen('wall');});
    $revealWrapper.addEventListener('click',function(e){e.stopPropagation();});

    // Admin close
    $adminCloseBtn.addEventListener('click',function(e){e.stopPropagation();closeWall();});

    // Touch drag
    document.addEventListener('touchstart',function(e){
      if(state.screen!=='wall') return;
      var touch=e.touches[0];
      if(state._placingNew&&state._newEl){startDrag(state._newEl,touch.clientX,touch.clientY,true);state._placingNew=false;state._newEl=null;e.preventDefault();return;}
      var tgt=document.elementFromPoint(touch.clientX,touch.clientY);
      if(tgt&&tgt.classList.contains('postit')&&!drag.active){startDrag(tgt,touch.clientX,touch.clientY,false);e.preventDefault();}
    },{passive:false});
    document.addEventListener('touchmove',function(e){if(drag.active){moveDrag(e.touches[0].clientX,e.touches[0].clientY);e.preventDefault();}},{passive:false});
    document.addEventListener('touchend',function(e){if(drag.active)endDrag();},{passive:false});

    // Mouse drag
    document.addEventListener('mousedown',function(e){
      if(state.screen!=='wall') return;
      if(state._placingNew&&state._newEl){startDrag(state._newEl,e.clientX,e.clientY,true);state._placingNew=false;state._newEl=null;e.preventDefault();return;}
      var tgt=document.elementFromPoint(e.clientX,e.clientY);
      if(tgt&&tgt.classList.contains('postit')&&!drag.active){startDrag(tgt,e.clientX,e.clientY,false);e.preventDefault();}
    });
    document.addEventListener('mousemove',function(e){if(drag.active)moveDrag(e.clientX,e.clientY);});
    document.addEventListener('mouseup',function(e){if(drag.active)endDrag();});

    ['touchstart','touchmove','keydown','input'].forEach(function(evt){
      document.addEventListener(evt,resetInactivity,{passive:true});
    });
  }

  // =============================================
  // INIT
  // =============================================
  var _inited = false;
  async function init() {
    if (_inited) return;
    _inited = true;

    loadLocalPrefs();
    applyLang();
    setup();

    // Parse URL params
    var params = new URLSearchParams(window.location.search);
    var code = params.get('code');
    adminSecret = params.get('admin');

    if (code) {
      var wall = await validateCode(code);
      if (wall) {
        await enterWall(wall);
      } else {
        showCodeScreen(t('codeError'));
      }
    } else {
      showCodeScreen();
    }

    $loading.classList.add('hidden');
  }

  var ft = setTimeout(function() { init(); }, 3000);
  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(function() { clearTimeout(ft); init(); });
  }

})();
</script>

</body>
</html>
